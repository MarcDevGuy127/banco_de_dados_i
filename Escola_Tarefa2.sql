CREATE DATABASE Escola;
USE Escola;

/*---------TABELA ALUNO---------------------------*/
CREATE TABLE ALUNO  (
    MATRICULA VARCHAR(20) NOT NULL PRIMARY KEY,
    NOME      VARCHAR(100),
    SEXO      CHAR(1),
    CPF       VARCHAR(11),
    RG        NUMERIC(10),
    DATANASCIMENTO DATE,
    CIDADE   VARCHAR(50),
    BAIRRO   VARCHAR(50),
    CEP      VARCHAR(10),
    ENDERECO VARCHAR(50),
);



/*---------TABELA PROFESSOR---------------------------*/
CREATE TABLE PROFESSOR (
    MATRICULA VARCHAR(20) NOT NULL PRIMARY KEY ,
    NOME      VARCHAR(100),
    SEXO      CHAR(1),
    CPF       VARCHAR(11),
    RG        NUMERIC(10),
    DATANASCIMENTO DATE,
    ESPECIALIDADE VARCHAR(100),
    DATAFORMACAO DATE,
    NOMEFACULDADEFORMACAO VARCHAR(100), 
    CIDADE   VARCHAR(50),
    BAIRRO   VARCHAR(50),
    CEP      VARCHAR(10),
    ENDERECO VARCHAR(50)
);


/*---------TABELA DISCIPLINA-------------------------*/
CREATE TABLE DISCIPLINA(
    CODDISCIPLINA   VARCHAR(20) NOT NULL PRIMARY KEY,
    NOMEDISCIPLINA  VARCHAR(100),
    CARGAHORARIA    INT
);


/*---------TABELA TURMA-------------------------*/
CREATE TABLE TURMA( 
    CODTURMA       VARCHAR(20) NOT NULL PRIMARY KEY,
    CODDISCIPLINA  VARCHAR(20) NOT NULL FOREIGN KEY (CODDISCIPLINA) REFERENCES DISCIPLINA (CODDISCIPLINA),
    NOMETURMA      VARCHAR(100),
    SALA           VARCHAR(10),
    TURNO          VARCHAR(20)
);


/*---------TABELA FREQUENTA----------------------*/
CREATE TABLE FREQUENTA
  ( MATRICULA 	VARCHAR(20) NOT NULL FOREIGN KEY (MATRICULA) REFERENCES ALUNO (MATRICULA),
    CODTURMA	VARCHAR(20) NOT NULL FOREIGN KEY (CODTURMA) REFERENCES   TURMA (CODTURMA),
    NOTA        NUMERIC(4,2),
    FALTA       INT,
    SEMESTRE    INT,
    ANO         INT,
    PRIMARY KEY (MATRICULA, CODTURMA)
);


/*---------TABELA ENSINA--------------------------*/
CREATE TABLE ENSINA
  ( MATRICULA  VARCHAR(20) NOT NULL FOREIGN KEY (MATRICULA) REFERENCES PROFESSOR (MATRICULA),
    CODTURMA   VARCHAR(20) NOT NULL FOREIGN KEY (CODTURMA) REFERENCES TURMA (CODTURMA),
    PRIMARY KEY (MATRICULA, CODTURMA)
);

/* Insercao de alunos */
INSERT INTO ALUNO VALUES ('RA12004127','Maria Fernandes','F','48894373800',429434121,'1991-10-21','Brasilia','Taguatinga Sul','72025650','QSF 14 LOTE 101');
INSERT INTO ALUNO VALUES ('RA12005258','Claudio Manuel','M','34293479716',911225341,'1987-07-05','Brasilia','Taguatinga Sul','72025610','QSA 13 LOTE 24');
INSERT INTO ALUNO VALUES ('RA12003320','Marco Antonio','M','78483864657',418757896,'1990-02-14','Brasilia','Samambaia Sul','72025500','QR 405 Conj. D LOTE 23');
INSERT INTO ALUNO VALUES ('RA12004250','Ane Sampaio','F','31307242731',2977269,'1991-03-12','Brasilia','Samambaia Sul','72025503','QR 404 Conj. C LOTE 51');
INSERT INTO ALUNO VALUES ('RA12006429','Silva Santos','F','54048852973',403289440,'1990-05-16','Brasilia','Samambaia Sul','72025512','QR 200 Conj. A LOTE 31');
INSERT INTO ALUNO VALUES ('RA12005437','Joao Pessoa','M','33608346074',2840973,'1990-08-14','Brasilia','Aguas Claras','71902180','QD 301 Conj. 08 LOTE 504');
INSERT INTO ALUNO VALUES ('RA12003156','Angela Maria','F','52624356100',408189466,'1990-02-28','Brasilia','Aguas Claras','71901100','QD 301 Conj. 02 LOTE 371');
INSERT INTO ALUNO VALUES ('RA12003124','Carlos Henrique','M','21155516214',316225362,'1991-04-21','Brasilia','Aguas Claras','71903000','QD 301 Conj 12 LOTE  211');
INSERT INTO ALUNO VALUES ('RA12003369','Wilson Marques','M','26164232007',376031369,'1990-06-12','Brasilia','Aguas Claras','71905000','QD 301 Rua D Conj 01 ');
INSERT INTO ALUNO VALUES ('RA12001479','Vera Lucia','F','27892786368',773030049,'1991-10-22','Brasilia','Samambaia Norte','72316002','QR 206 Conjunto 2 LOTE 307');
INSERT INTO ALUNO VALUES ('RA12006681','Edson Fonseca','M','85255901776',774587125,'1990-09-24','Brasilia','Samambaia Norte','72316042','QN 202 Conjunto 2 LOTE 402');
INSERT INTO ALUNO VALUES ('RA12004412','Valeria Rocha','F','37746776540',761566538,'1992-03-23','Brasilia','Asa Norte','70002904','SBN Quadra 1 Bloco A ED. CATARINA LOTE 301');
INSERT INTO ALUNO VALUES ('RA12005208','Jose Carlos','M','45221044560',782567144,'1991-07-19','Brasilia','Asa Norte','70040909','SBN Quadra 2 Bloco A ED.PARAISO LOTE 119');
INSERT INTO ALUNO VALUES ('RA12000749','Benta Lima','F','77114375107',780089351,'1990-06-25','Brasilia','Asa Norte','70378853','SBN Quadra 2 Bloco K LOTE 44');
INSERT INTO ALUNO VALUES ('RA12008321','Fernando Cardoso','M','51615025928',786818925,'1990-01-23','Brasilia','Asa Norte','70378853','SBN Quadra 1 Bloco F ED.MARE RADIANTE LOTE 67');
INSERT INTO ALUNO VALUES ('RA12008779','Alexandre Aguiar','M','24778725751',783326945,'1988-07-02','Brasilia','Asa Norte','70041900','SBN Quadra CLN 102 Bloco D LOTE 20');
INSERT INTO ALUNO VALUES ('RA12003341','Bruno Santos','M','65234980855',310028735,'1990-03-21','Brasilia','Ceilandia Norte','72225194','QNN Quadra 19 Conjunto D LOTE 33');

SELECT * FROM ALUNO;

/* Insercao de professores */
INSERT INTO PROFESSOR VALUES ('RA01003056','Felipe Moura','M','58083577219',2856971,'1960-06-17','Desenvolvimento de Software','1981-05-12','Universidade Catolica de Brasilia','Brasilia','Ceilandia Sul','72215033','QNM Quadra 3 Conjunto C LOTE 306');
INSERT INTO PROFESSOR VALUES ('RA02003753','Patricia Mattos','F','54945566704',24046719,'1973-08-01','Administracao de Empresas','1998-05-12','Universidade Rio Grande do Sul','Brasilia','Ceilandia Sul','72215033','QNM Quadra 19 Conjunto H LOTE 105');
INSERT INTO PROFESSOR VALUES ('RA09814475','Iara Mourinho','F','66138498470',300512368,'1978-11-10','Matematica','1991-05-12','Universidade Caxias do Sul','Brasilia','Ceilandia Norte','72159136','EQNN Quadra 1/3 Bloco A LOTE 224');
INSERT INTO PROFESSOR VALUES ('RA02011334','Renato Amado','M','41762488744',221823084,'1962-10-10','Engenharia Mecanica','1985-05-12','Universidade de Brasilia','Brasilia','Taguatinga Norte','72110020','QNA Quadra 2 LOTE 813');
INSERT INTO PROFESSOR VALUES ('RA01015289','Gabriel Formiga','M','05025197899',216782359,'1971-04-17','Engenharia de Software','1995-05-12','Universidade Catolica de Brasilia','Brasilia','Taguatinga Norte','72110030','QNA Quadra 3 LOTE 60');
INSERT INTO PROFESSOR VALUES ('RA02001732','Wagner Sampaio','M','01181864690',896273413,'1977-02-27','Inteligencia Artificial','1998-05-12','Universidade de Brasilia','Brasilia','Taguatinga Norte','72531562','QNA Quadra 6 LOTE 42');
INSERT INTO PROFESSOR VALUES ('RA02036714','Katia Galvao','F','78961770489',813250921,'1977-02-21','Literatura','1998-05-12','Universidade Catolica de Brasilia','Brasilia','Taguatinga Norte','72531562','QNA Quadra 6 LOTE 42');
INSERT INTO PROFESSOR VALUES ('RA010067352','Brenda Oliveira','F','11374536997',2840173,'1961-05-19','Literatura','1990-05-12','Universidade Catolica de Brasilia','Brasilia','Taguatinga Norte','72531562','QNA Quadra 21 LOTE 56');

SELECT * FROM PROFESSOR;

/* Insercao de disciplinas */
INSERT INTO DISCIPLINA  VALUES ('D01','Algoritmos e Programacao',120);
INSERT INTO DISCIPLINA  VALUES ('D02','Logica Matematica',60);
INSERT INTO DISCIPLINA  VALUES ('D03','Matematica Discreta',60);
INSERT INTO DISCIPLINA  VALUES ('D04','Arquitetura de Computadores 1',60);
INSERT INTO DISCIPLINA  VALUES ('D05','Introducao ao Ensino Superior',60);

SELECT * FROM DISCIPLINA;

/* Insercao de turmas */
/* Turmas de algoritmos */
INSERT INTO TURMA  VALUES ('T01','D01','MIA','R01A','Matutino');
INSERT INTO TURMA  VALUES ('T02','D01','MIB','R01B','Matutino');

/* Turmas de Logica Matematica */
INSERT INTO TURMA VALUES ('T03','D02','MIA','C200','Matutino');

/* Turmas de matematica discreta */
INSERT INTO TURMA  VALUES ('T04','D03','MIA','C004','Matutino');
INSERT INTO TURMA  VALUES ('T05','D03','MIB','C004','Matutino');

/* Turmas de arquitetura de computadores 1 */
INSERT INTO TURMA  VALUES ('T06','D04','MIA','D102','Matutino');
INSERT INTO TURMA  VALUES ('T07','D04','MIB','B106','Matutino');

/* Turmas de Introducao ao Ensino Superior */
INSERT INTO TURMA  VALUES ('T08','D05','MIA','D002','Matutino');
INSERT INTO TURMA  VALUES ('T09','D05','MIB','D002','Noturno');

SELECT * FROM TURMA;

/* Relacionandos os professor com as turmas */
/* Professores Felipe Moura,Gabriel Formiga ensina as turmas de algoritmos */
INSERT INTO ENSINA VALUES ('RA01003056','T01');
INSERT INTO ENSINA VALUES ('RA01015289','T02');

/* Professor Wagner Sampaio ensina turma de logica matematica  */
INSERT INTO ENSINA VALUES ('RA02001732','T03');

/* Professor Iara Mourinho ensina as turmas de matematica discreta  */
INSERT INTO ENSINA VALUES ('RA09814475','T04');
INSERT INTO ENSINA VALUES ('RA09814475','T05');

/* Professor Renato Amado ensina as turmas de arquitetura de computadores 1 */
INSERT INTO ENSINA VALUES ('RA02011334','T06');
INSERT INTO ENSINA VALUES ('RA02011334','T07');

/* Professor Katia,Brenda ensina as turmas de Introducao ao Ensino Superior */
INSERT INTO ENSINA VALUES ('RA02036714','T08');
INSERT INTO ENSINA VALUES ('RA010067352','T09');

SELECT * FROM ENSINA;

/* Insercao dos alunos na turma */
/* Maria Fernandes */
INSERT INTO  FREQUENTA  VALUES ('RA12004127','T01',8.6,0,1,2012);  
INSERT INTO  FREQUENTA  VALUES ('RA12004127','T03',7.0,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004127','T04',7.5,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004127','T06',8.1,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004127','T08',10.0,0,1,2012); 

SELECT * FROM FREQUENTA;

/* Claudio Manuel */
INSERT INTO  FREQUENTA  VALUES ('RA12005258','T01',7.0,2,1,2012);  
INSERT INTO  FREQUENTA  VALUES ('RA12005258','T03',7.5,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005258','T04',7.3,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005258','T06',6.0,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005258','T08',8.5,8,1,2012);

/* Wilson Marques */ 
INSERT INTO  FREQUENTA  VALUES ('RA12003369','T01',9.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003369','T03',10,0,1,2012);   
INSERT INTO  FREQUENTA  VALUES ('RA12003369','T04',9.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003369','T06',8.7,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003369','T08',9.0,0,1,2012); 

/* Silva Santos */ 
INSERT INTO  FREQUENTA  VALUES ('RA12006429','T02',4.3,8,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006429','T03',7.0,0,1,2012);   
INSERT INTO  FREQUENTA  VALUES ('RA12006429','T04',6.1,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006429','T06',6.3,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006429','T08',8.0,0,1,2012); 

/* Joao Pessoa */
INSERT INTO  FREQUENTA  VALUES ('RA12005437','T02',8.1,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005437','T03',8.5,0,1,2012);   
INSERT INTO  FREQUENTA  VALUES ('RA12005437','T04',7.1,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005437','T06',9.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005437','T08',9.7,2,1,2012); 

/* Angela Maria */
INSERT INTO  FREQUENTA  VALUES ('RA12003156','T02',7.5,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003156','T03',7.8,0,1,2012);   
INSERT INTO  FREQUENTA  VALUES ('RA12003156','T05',7.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003156','T07',8.1,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003156','T09',8.4,0,1,2012);

/* Vera Lucia */ 
INSERT INTO  FREQUENTA  VALUES ('RA12001479','T02',1.2,12,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12001479','T03',3.0,6,1,2012);   
INSERT INTO  FREQUENTA  VALUES ('RA12001479','T05',4.1,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12001479','T07',5.0,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12001479','T09',7.0,2,1,2012);

/* Marco Antonio  */ 
INSERT INTO  FREQUENTA  VALUES ('RA12003320','T02',9.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003320','T05',9.6,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003320','T07',9.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003320','T09',10.0,0,1,2012);

/* Carlos Henrique  */
INSERT INTO  FREQUENTA  VALUES ('RA12003124','T01',9.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003124','T05',9.6,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003124','T07',9.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003124','T09',10.0,0,1,2012);

/* Edson Fonseca   */
INSERT INTO  FREQUENTA  VALUES ('RA12006681','T01',4.8,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006681','T05',7.3,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006681','T07',6.9,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12006681','T09',8.3,2,1,2012);

/* Valeria Rocha   */
INSERT INTO  FREQUENTA  VALUES ('RA12004412','T01',5.6,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004412','T03',8.1,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004412','T05',7.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004412','T07',8.3,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12004412','T09',10.0,0,1,2012);

/* Jose Carlos   */
INSERT INTO  FREQUENTA  VALUES ('RA12005208','T02',7.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005208','T03',8.5,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005208','T04',8.9,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005208','T06',9.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12005208','T08',8.8,4,1,2012);

/* Benta Lima */
INSERT INTO  FREQUENTA  VALUES ('RA12000749','T02',4.3,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12000749','T03',8.6,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12000749','T04',7.2,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12000749','T06',8.8,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12000749','T08',8.0,0,1,2012);

/* Fernando Cardoso */
INSERT INTO  FREQUENTA  VALUES ('RA12008321','T02',7.1,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008321','T03',6.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008321','T05',8.3,4,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008321','T06',7.4,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008321','T08',9.0,0,1,2012);

/* Alexandre Aguiar */
INSERT INTO  FREQUENTA  VALUES ('RA12008779','T01',7.1,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008779','T03',7.8,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008779','T05',5.0,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008779','T07',7.2,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12008779','T09',8.1,0,1,2012);

/* Bruno Santos */
INSERT INTO  FREQUENTA  VALUES ('RA12003341','T02',10.0,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003341','T03',9.3,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003341','T04',8.5,2,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003341','T06',9.6,0,1,2012); 
INSERT INTO  FREQUENTA  VALUES ('RA12003341','T08',8.7,0,1,2012);

SELECT * FROM FREQUENTA;

SELECT * FROM PROFESSOR;


-- 1. Apresente o código SQL para listar os professores (nome do professor e nome da disciplina) que ministram a disciplina de Algoritmos e Programação
SELECT P.NOME AS PROFESSOR, D.NOMEDISCIPLINA
FROM PROFESSOR P
INNER JOIN ENSINA E ON P.MATRICULA = E.MATRICULA
INNER JOIN TURMA T ON E.CODTURMA = T.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
WHERE D.NOMEDISCIPLINA = 'Algoritmos e Programacao';

-- 2. Apresente o código SQL para listar a média aritmética da turma T04 de matemática discreta.
SELECT CODTURMA AS TURMA, AVG(NOTA) AS MEDIA
FROM FREQUENTA
WHERE CODTURMA = 'T04'
GROUP BY CODTURMA;

-- 3. Apresente o código SQL para listar o nome da aluna, matrícula e nome de todas as disciplinas que a aluna Maria Fernandes está cursando.
SELECT 
    A.NOME,
    A.MATRICULA,
    D.NOMEDISCIPLINA
FROM ALUNO A
INNER JOIN FREQUENTA F ON F.MATRICULA = A.MATRICULA
INNER JOIN TURMA T ON T.CODTURMA = F.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
WHERE A.NOME = 'Maria Fernandes';

-- 4.  Apresente o código SQL para encontrar quantas turmas existem de Matemática Discreta e quem são seus professores
SELECT T.NOMETURMA, D.NOMEDISCIPLINA, P.NOME AS PROFESSOR
FROM PROFESSOR P
INNER JOIN ENSINA E ON P.MATRICULA = E.MATRICULA
INNER JOIN TURMA T ON E.CODTURMA = T.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
WHERE D.NOMEDISCIPLINA = 'Matematica Discreta';

-- 5. Apresente o código SQL para encontrar a maior nota da turma T08 de Introdução ao Ensino Superior
SELECT MAX(F.NOTA) AS MAIOR_NOTA
FROM FREQUENTA F
WHERE F.CODTURMA = 'T08';

-- 6. Liste os alunos (nome e matrícula) que possuem a maior nota em alguma turma.
SELECT A.NOME, A.MATRICULA, F.CODTURMA, F.NOTA
FROM FREQUENTA F
INNER JOIN ALUNO A ON A.MATRICULA = F.MATRICULA
WHERE F.NOTA = (SELECT MAX(F2.NOTA) FROM FREQUENTA F2 WHERE F2.CODTURMA = F.CODTURMA);

-- 7.  Liste o nome e matrícula dos alunos que têm nota maior do que a média geral das notas. 
SELECT 
    A.NOME,
    A.MATRICULA,
    T.NOMETURMA,
    D.NOMEDISCIPLINA,
    F.NOTA
FROM FREQUENTA F
INNER JOIN ALUNO A ON A.MATRICULA = F.MATRICULA
INNER JOIN TURMA T ON T.CODTURMA = F.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
WHERE F.NOTA > (SELECT AVG(F2.NOTA) FROM FREQUENTA F2);

-- 8. Aumente em 1 ponto a nota de todos os alunos que estão em turmas ministradas por um professor com especialidade em 'Algoritmos e Programacao'.
UPDATE F
SET F.NOTA = F.NOTA + 1
FROM FREQUENTA F
INNER JOIN TURMA T ON F.CODTURMA = T.CODTURMA
INNER JOIN ENSINA E ON T.CODTURMA = E.CODTURMA
INNER JOIN PROFESSOR P ON E.MATRICULA = P.MATRICULA
WHERE P.ESPECIALIDADE = 'Algoritmos e Programacao';

-- 9. Liste o código da turma e a média de notas dos alunos por turma, apenas das turmas com média acima de 7.
SELECT 
    T.CODTURMA,
    T.NOMETURMA,
    D.NOMEDISCIPLINA,
    AVG(F.NOTA) AS MEDIA_NOTAS
FROM FREQUENTA F
INNER JOIN TURMA T ON T.CODTURMA = F.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
GROUP BY T.CODTURMA, T.NOMETURMA, D.NOMEDISCIPLINA
HAVING AVG(F.NOTA) > 7;

-- 10. Crie uma nova tabela chamada `ALUNOS_BONS` com os dados (matrícula, nota) de alunos que têm nota maior que 8.
SELECT F.MATRICULA, F.NOTA
INTO ALUNOS_BONS
FROM FREQUENTA F
WHERE F.NOTA > 8;
SELECT * FROM ALUNOS_BONS;
-- 11. Liste os nomes dos professores que lecionam em turmas de disciplinas com carga horária maior que 60 horas.
SELECT DISTINCT P.NOME AS PROFESSOR
FROM PROFESSOR P
INNER JOIN ENSINA E ON P.MATRICULA = E.MATRICULA
INNER JOIN TURMA T ON E.CODTURMA = T.CODTURMA
INNER JOIN DISCIPLINA D ON T.CODDISCIPLINA = D.CODDISCIPLINA
WHERE D.CARGAHORARIA > 60;

-- 12. Copie os dados de todos os professores que moram na cidade de "Brasilia" para uma nova tabela chamada `PROFESSOR_BSB`, incluindo todos os campos da tabela original. Observação: crie a nova tabela usando `SELECT INTO` antes de usar o `INSERT INTO`.
SELECT *
INTO PROFESSOR_BSB
FROM PROFESSOR
WHERE CIDADE = 'Brasilia';

SELECT * FROM PROFESSOR_BSB;

--13. Altere o Banco de Dados para permitir que o sistema possa ser utilizado pelo Unibrasil (além da alteração da estrutura do BD, apresentar todo o código para evitar que os dados atuais sejam perdidos)

ALTER TABLE ALUNO ADD INSTITUICAO VARCHAR(50) DEFAULT 'Escola';
ALTER TABLE PROFESSOR ADD INSTITUICAO VARCHAR(50) DEFAULT 'Escola';

INSERT INTO ALUNO (MATRICULA, NOME, SEXO, CPF, RG, DATANASCIMENTO, CIDADE, BAIRRO, CEP, ENDERECO, INSTITUICAO)
VALUES ('UB0001', 'Joao Unibrasil', 'M', '12345678901', 123456789, '2000-01-01', 'Brasilia', 'Asa Norte', '70000000', 'QNN 01 Conj A Lote 01', 'Unibrasil');

INSERT INTO PROFESSOR (MATRICULA, NOME, SEXO, CPF, RG, DATANASCIMENTO, ESPECIALIDADE, DATAFORMACAO, NOMEFACULDADEFORMACAO, CIDADE, BAIRRO, CEP, ENDERECO, INSTITUICAO)
VALUES ('UBP0001', 'Ana Unibrasil', 'F', '10987654321', 987654321, '1980-05-10', 'Matematica', '2002-12-01', 'Unibrasil', 'Brasilia', 'Asa Sul', '70000001', 'SQS 02 Conj B Lote 02', 'Unibrasil');

SELECT * FROM ALUNO WHERE ALUNO.INSTITUICAO = 'Unibrasil';
SELECT * FROM PROFESSOR WHERE PROFESSOR.INSTITUICAO = 'Unibrasil';

